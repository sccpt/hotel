(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{KWSo:function(w,C,a){w.exports={main:"main___2yGev",leftMenu:"leftMenu___179-W",right:"right___2jdGg",title:"title___3cGwa"}},O4pj:function(w,C,a){"use strict";a.r(C);var B=a("fWQN"),D=a("mtLc"),x=a("yKVA"),z=a("879j"),me=a("lUTK"),L=a("BvKs"),F=a("q1tI"),e=a.n(F),o=a("9kvl"),W=a("FRQA"),ge=a("y8nQ"),p=a("Vl3Y"),ve=a("5NDa"),E=a("5rEg"),U=a("k1fw"),pe=a("DZo9"),Q=a("8z0m"),fe=a("+L6B"),I=a("2/Rp"),he=a("miYZ"),j=a("tsqr"),Ee=a("OaEy"),K=a("2fM7"),$=a("z7Xi"),X=a("YHME"),O=a.n(X),Y=a("kRQd"),G=K.a.Option,H=function(u){var i=u.avatar,n=u.dispatch,t=u.id;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:O.a.avatar_title},e.a.createElement(o.a,{id:"accountandsettings.basic.avatar",defaultMessage:"Avatar"})),e.a.createElement("div",{className:O.a.avatar},e.a.createElement("img",{src:i,alt:"avatar"})),e.a.createElement(Q.a,{action:"/api/v1/upload",showUploadList:!1,accept:"image/png, image/jpeg, image/gif",beforeUpload:function(s){return s.type==="image/png"||s.type==="image/jpeg"||s.type==="image/gif"},onChange:function(s){var r=s.file;r.status==="done"&&r.response&&r.response.message==="\u6210\u529F"&&n&&n({type:"accountAndsettings/updateAvatar",payload:{id:t,avatar:r.response.data.path},callback:function(c){c.message==="\u4FEE\u6539\u6210\u529F"?(j.default.success(c.message),window.location.reload()):j.default.error(c.message||"\u4FEE\u6539\u5931\u8D25")}})},headers:{Authorization:Y.a.get()||""}},e.a.createElement("div",{className:O.a.button_view},e.a.createElement(I.a,null,e.a.createElement($.a,null),e.a.createElement(o.a,{id:"accountandsettings.basic.change-avatar",defaultMessage:"Change avatar"})))))},J=function(g){Object(x.a)(i,g);var u=Object(z.a)(i);function i(){var n;Object(B.a)(this,i);for(var t=arguments.length,d=new Array(t),s=0;s<t;s++)d[s]=arguments[s];return n=u.call.apply(u,[this].concat(d)),n.formRef=e.a.createRef(),n.getData=function(){var r=n.props.dispatch;r&&r({type:"accountAndsettings/fetchCurrent",callback:function(c){c.message==="\u67E5\u8BE2\u6210\u529F"&&n.formRef.current.setFieldsValue(c.data.user)}})},n.view=void 0,n.getViewDom=function(r){n.view=r},n.handleFinish=function(r){var v=n.props,c=v.dispatch,y=v.currentUser,P=[];y.user&&y.user.roles.map(function(S){return P.push(S.id),null}),c&&c({type:"accountAndsettings/updateAccount",payload:Object(U.a)(Object(U.a)({},y.user),{},{roleIds:P},r),callback:function(A){A.code===100030&&A.message==="\u4FEE\u6539\u6210\u529F"?(j.default.success(A.message),n.getData()):j.default.error(A.message||"\u4FEE\u6539\u5931\u8D25")}})},n}return Object(D.a)(i,[{key:"componentDidMount",value:function(){this.getData()}},{key:"getAvatarURL",value:function(){var t=this.props.currentUser;return t.user&&t.user.avatar?t.user.avatar:""}},{key:"render",value:function(){var t=this.props,d=t.updateLoading,s=t.dispatch,r=t.currentUser;return e.a.createElement("div",{className:O.a.baseView,ref:this.getViewDom},e.a.createElement("div",{className:O.a.left},e.a.createElement(p.a,{layout:"vertical",ref:this.formRef,onFinish:this.handleFinish},e.a.createElement(p.a.Item,{name:"nickName",label:"\u7528\u6237\u6635\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u6635\u79F0"}]},e.a.createElement(E.a,null)),e.a.createElement(p.a.Item,{name:"mobile",label:"\u624B\u673A\u53F7\u7801",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801"}]},e.a.createElement(E.a,null)),e.a.createElement(p.a.Item,{name:"email",label:"\u90AE\u7BB1",rules:[{required:!1,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1"}]},e.a.createElement(E.a,null)),e.a.createElement(p.a.Item,{name:"sex",label:"\u6027\u522B",rules:[{required:!1,message:"\u8BF7\u9009\u62E9\u6027\u522B"}]},e.a.createElement(K.a,{style:{maxWidth:220}},e.a.createElement(G,{value:"0"},"\u7537"),e.a.createElement(G,{value:"1"},"\u5973"))),e.a.createElement(p.a.Item,null,e.a.createElement(I.a,{htmlType:"submit",type:"primary",loading:d},e.a.createElement(o.a,{id:"accountandsettings.basic.update",defaultMessage:"Update Information"}))))),e.a.createElement("div",{className:O.a.right},e.a.createElement(H,{avatar:this.getAvatarURL(),dispatch:s,id:r.user&&r.user.id||""})))}}]),i}(F.Component),Z=Object(o.b)(function(g){var u=g.accountAndsettings,i=g.loading;return{currentUser:u.currentUser,loadingFetch:i.effects["accountAndsettings/fetchCurrent"],updateLoading:i.effects["accountAndsettings/updateAccount"]}})(J),ye=a("Q9mQ"),k=a("diRs"),be=a("MXD1"),q=a("CFYs"),R=a("tJVT"),_=a("rXhD"),h=a.n(_),V=p.a.Item,we=K.a.Option,je=E.a.Group,ee={ok:e.a.createElement("div",{className:h.a.success},e.a.createElement(o.a,{id:"userandregister.strength.strong"})),pass:e.a.createElement("div",{className:h.a.warning},e.a.createElement(o.a,{id:"userandregister.strength.medium"})),poor:e.a.createElement("div",{className:h.a.error},e.a.createElement(o.a,{id:"userandregister.strength.short"}))},ae={ok:"success",pass:"normal",poor:"exception"},te=function(u){var i=u.submitting,n=u.dispatch,t=Object(F.useState)(!1),d=Object(R.a)(t,2),s=d[0],r=d[1],v=Object(F.useState)(!1),c=Object(R.a)(v,2),y=c[0],P=c[1],S=!1,A=p.a.useForm(),le=Object(R.a)(A,1),b=le[0],T=function(){var l=b.getFieldValue("newPassword");return l&&l.length>9?"ok":l&&l.length>5?"pass":"poor"},ce=function(l){n({type:"accountAndsettings/changePwd",payload:Object(U.a)({},l),callback:function(f){f.message==="\u4FEE\u6539\u6210\u529F"?(j.default.success("\u4FEE\u6539\u6210\u529F\uFF0C\u8BF7\u4F7F\u7528\u65B0\u5BC6\u7801\u91CD\u65B0\u767B\u5F55\uFF01"),o.d.replace("/user/login")):j.default.error(f.message||"\u4FEE\u6539\u5931\u8D25")}})},oe=function(l,m){var f=Promise;return m&&m!==b.getFieldValue("newPassword")?f.reject(Object(o.c)({id:"userandregister.password.twice"})):f.resolve()},ue=function(l,m){var f=Promise;return m?(s||r(!!m),P(!y),m.length<6?f.reject(""):(m&&S&&b.validateFields(["confirm"]),f.resolve())):(r(!!m),f.reject(Object(o.c)({id:"userandregister.password.required"})))},de=function(){var l=b.getFieldValue("newPassword"),m=T();return l&&l.length?e.a.createElement("div",{className:h.a["progress-".concat(m)]},e.a.createElement(q.a,{status:ae[m],className:h.a.progress,strokeWidth:6,percent:l.length*10>100?100:l.length*10,showInfo:!1})):null};return e.a.createElement("div",{className:h.a.main},e.a.createElement(p.a,{form:b,name:"UserRegister",onFinish:ce},e.a.createElement(V,{name:"password",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65E7\u5BC6\u7801"}]},e.a.createElement(E.a,{size:"large",placeholder:"\u65E7\u5BC6\u7801"})),e.a.createElement(k.a,{getPopupContainer:function(l){return l&&l.parentNode?l.parentNode:l},content:s&&e.a.createElement("div",{style:{padding:"4px 0"}},ee[T()],de(),e.a.createElement("div",{style:{marginTop:10}},e.a.createElement(o.a,{id:"userandregister.strength.msg"}))),overlayStyle:{width:240},placement:"right",visible:s},e.a.createElement(V,{name:"newPassword",className:b.getFieldValue("newPassword")&&b.getFieldValue("newPassword").length>0&&h.a.password,rules:[{validator:ue}]},e.a.createElement(E.a,{size:"large",type:"password",placeholder:"\u65B0\u5BC6\u7801"}))),e.a.createElement(V,{name:"confirm",rules:[{required:!0,message:Object(o.c)({id:"userandregister.confirm-password.required"})},{validator:oe}]},e.a.createElement(E.a,{size:"large",type:"password",placeholder:Object(o.c)({id:"userandregister.confirm-password.placeholder"})})),e.a.createElement(V,null,e.a.createElement(I.a,{size:"large",loading:i,className:h.a.submit,type:"primary",htmlType:"submit"},"\u786E\u5B9A\u4FEE\u6539"))))},se=Object(o.b)(function(g){var u=g.accountAndsettings,i=g.loading;return{currentUser:u.currentUser,submitting:i.effects["accountAndsettings/changePwd"]}})(te),re=a("KWSo"),N=a.n(re),ne=L.a.Item,ie=function(g){Object(x.a)(i,g);var u=Object(z.a)(i);function i(n){var t;Object(B.a)(this,i),t=u.call(this,n),t.main=void 0,t.getMenu=function(){var s=t.state.menuMap;return Object.keys(s).map(function(r){return e.a.createElement(ne,{key:r},s[r])})},t.getRightTitle=function(){var s=t.state,r=s.selectKey,v=s.menuMap;return v[r]},t.selectKey=function(s){t.setState({selectKey:s})},t.renderChildren=function(){var s=t.state.selectKey;switch(s){case"base":return e.a.createElement(Z,null);case"security":return e.a.createElement(se,null);default:break}return null};var d={base:e.a.createElement(o.a,{id:"accountandsettings.menuMap.basic",defaultMessage:"Basic Settings"}),security:"\u4FEE\u6539\u5BC6\u7801"};return t.state={mode:"inline",menuMap:d,selectKey:"base"},t}return Object(D.a)(i,[{key:"render",value:function(){var t=this,d=this.state,s=d.mode,r=d.selectKey;return e.a.createElement(W.a,null,e.a.createElement("div",{className:N.a.main,ref:function(c){c&&(t.main=c)}},e.a.createElement("div",{className:N.a.leftMenu},e.a.createElement(L.a,{mode:s,selectedKeys:[r],onClick:function(c){var y=c.key;return t.selectKey(y)}},this.getMenu())),e.a.createElement("div",{className:N.a.right},e.a.createElement("div",{className:N.a.title},this.getRightTitle()),this.renderChildren())))}}]),i}(F.Component),Oe=C.default=ie},YHME:function(w,C,a){w.exports={baseView:"baseView___3sRG3",left:"left___GavW0",right:"right___3-EXe",avatar_title:"avatar_title___13ztg",avatar:"avatar___1GisI",button_view:"button_view___o9apF"}},rXhD:function(w,C,a){w.exports={main:"main___2AtMi",password:"password___1zZSu",getCaptcha:"getCaptcha___1RIzu",submit:"submit___3eLvx",login:"login___3PyV6",success:"success___xzVdH",warning:"warning___1C0WC",error:"error___2wCUM","progress-pass":"progress-pass___2M4Q8",progress:"progress___2bwcK"}}}]);
